{"version":3,"sources":["services/messenger/translators/translator.ts"],"names":[],"mappings":";;AAgBA,0CAA2C;AAa3C,qBAA6B,SAAQ,UAAU;IAQ9C,YAAY,IAAyB,EAAE,OAAe;QACrD,KAAK,CAAC,OAAO,CAAC,CAAC;QACf,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IAClB,CAAC;CACD;AAZD,0CAYC;AA0ED,0BAAiC,IAAY,EAAE,IAAS,EAAE,IAAe;IACxE,MAAM,CAAC,OAAO,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC,gBAAgB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAC1D,CAAC;AAFD,4CAEC","file":"translator.js","sourcesContent":["/*\n Copyright 2017 Resin.io\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n\nimport TypedError = require('typed-error');\nimport * as Promise from 'bluebird';\nimport {\n\tEmitInstructions, MessengerConstructor, MessengerEvent, MessengerResponse,\n\tTransmitInformation\n} from '../../messenger-types';\nimport { ServiceEvent } from '../../service-types';\nimport { DataHub } from '../datahubs/datahub';\nimport { TranslatorErrorCode } from './translator-types';\n\n/**\n * A TypedError that encapsulates some details specific to Translators.\n */\nexport class TranslatorError extends TypedError {\n\t/** What category of thing went wrong. */\n\tpublic code: TranslatorErrorCode;\n\n\t/**\n\t * @param code     The sub-type of this error.\n\t * @param message  The error message, is stored in the standard location.\n\t */\n\tconstructor(code: TranslatorErrorCode, message: string) {\n\t\tsuper(message);\n\t\tthis.code = code;\n\t}\n}\n\n/**\n * A translator is responsible for converting between:\n * - The specifics of a service's interactions.\n * - The communal standard for messages.\n */\nexport interface Translator {\n\t/**\n\t * Extract from an event (in the form specific to this service) a message type (in messenger phrasing).\n\t * @param event  Event to analyse.\n\t * @returns      Generic name for the event.\n\t */\n\teventIntoMessageType(event: MessengerEvent): string;\n\n\t/**\n\t * Convert a messenger phrased message type into a set of specific events.\n\t * @param type  Generic name for the event.\n\t * @returns     A list of specific events to listen to.\n\t */\n\tmessageTypeIntoEventTypes(type: string): string[];\n\n\t/**\n\t * Retrieve all of the events (in service specific phrasing) that this translator supports.\n\t * @returns  The list of specific event names understood.\n\t */\n\tgetAllEventTypes(): string[];\n\n\t/**\n\t * Promise to convert a provided event (in service specific form) into a message (in messenger form).\n\t * @param event  Service specific event, straight out of the ServiceListener.\n\t * @returns      Promise that resolves to the standard form of the message.\n\t */\n\teventIntoMessage(event: ServiceEvent): Promise<MessengerEvent>;\n\n\t/**\n\t * Promise to provide emitter construction details for a provided message.\n\t * @param message  Message information, used to retrieve username\n\t * @returns        Promise that resolves to the details required to construct an emitter.\n\t */\n\tmessageIntoEmitterConstructor(message: TransmitInformation): Promise<object>;\n\n\t/**\n\t * Populate the listener constructor with details from the more generic constructor.\n\t * Provided since the connectionDetails might need to be parsed from JSON and the server details might be instantiated.\n\t * @param connectionDetails  Construction details for the service, probably 'inert', ie from JSON.\n\t * @param genericDetails     Details from the construction of the messenger.\n\t * @returns                  Connection details with the value merged in.\n\t */\n\tmergeGenericDetails(connectionDetails: object, genericDetails: MessengerConstructor): object;\n\n\t/**\n\t * Convert the provided message into details that may be passed to the emitter.\n\t * @param message  Message object, in generic form, to create a payload from.\n\t * @returns        Promise to provide the payload that may be passed straight to the emitter.\n\t */\n\tmessageIntoEmitDetails(message: TransmitInformation): Promise<EmitInstructions>;\n\n\t/**\n\t * Convert the response from the emitter into a generic form\n\t * @param message   The original message, only used in services where the response is incomplete\n\t * @param response  The response from the emitter to convert\n\t * @returns         A promise that resolves to the generic form of the response\n\t */\n\tresponseIntoMessageResponse(message: TransmitInformation, response: any): Promise<MessengerResponse>;\n}\n\n/**\n * Retrieves and loads a Translator by name.\n * @param name  The name of the Utils to load.\n * @param data  The constructor object for the createTranslator method.\n * @param hubs  The sources for any extra information required.\n * @return      The newly instantiated Utils.\n */\nexport function createTranslator(name: string, data: any, hubs: DataHub[]): Translator {\n\treturn require(`./${name}`).createTranslator(data, hubs);\n}\n"],"sourceRoot":"../../../../lib"}